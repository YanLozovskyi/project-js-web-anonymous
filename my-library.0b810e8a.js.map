{"mappings":"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","sources":["src/js/pages/my-library/my-library.js","src/js/pages/my-library/refs.js","src/js/components/scrollForLibrary.js","src/js/pages/my-library/markupContentTextMessage.js"],"sourcesContent":["import Storage from '../../api/localStorageAPI/localStorageAPI';\nimport { STORAGE_KEY } from '../../localStorageKey/localStorageKey';\nimport { refs } from './refs';\nimport { createMarkupFilmsCards } from '../../components/createMarkupFilmCard';\nimport { markupContentTextMessage } from './markupContentTextMessage';\nimport { Loader } from '../../loader';\nimport { getscroll } from '../../components/scrollForLibrary';\nimport SlimSelect from 'slim-select';\nimport 'slim-select/dist/slimselect.css';\n\nconst PER_PAGE = 6;\n\nconst loader = new Loader();\n\nlet correctGenre = 'All';\nlet totalPage;\nlet page = 0;\nlet startIndex = 0;\nlet endIndex = 0;\nlet correctGenreMovieList = [];\n\nconst dataStorage = Storage.load(STORAGE_KEY.myLibraryMoviesList);\n\nrenderContentBasedOnConditions();\n\ndocument.addEventListener('click', function (e) {\n  if (e.target.dataset.action === 'add-remove-to-my-library') {\n    const dataStorage = Storage.load(STORAGE_KEY.myLibraryMoviesList);\n    if (dataStorage.length === 0) {\n      refs.genreList.removeEventListener('change', onSelectGenreListChange);\n      refs.myLibrarySection.classList.add(\n        'my-library-content-text-message-section'\n      );\n      refs.libraryContent.innerHTML = markupContentTextMessage();\n    }\n\n    renderLibraryCards(dataStorage);\n  }\n});\n\nfunction renderContentBasedOnConditions() {\n  // loader.onShow();\n  if (dataStorage?.length === 0) {\n    refs.genreList.removeEventListener('change', onSelectGenreListChange);\n    refs.myLibrarySection.classList.add(\n      'my-library-content-text-message-section'\n    );\n    refs.libraryContent.innerHTML = markupContentTextMessage();\n  } else if (dataStorage) {\n    //? Отримую унікальні ID жанрів фільмів, які є у localStorage і за допомогою функції createSelectOptionMarkup отримую розмітку з жанром, і вставляю у select\n    getscroll();\n    dataStorage\n      .reduce((acc, el) => [...acc, ...el.genres], [])\n      .filter(\n        (genre, index, self) =>\n          index ===\n          self.findIndex(g => g.id === genre.id && g.name === genre.name)\n      )\n      .forEach(el =>\n        refs.genreList.insertAdjacentHTML(\n          'beforeend',\n          createSelectOptionMarkup(el)\n        )\n      );\n\n    new SlimSelect({\n      select: '#my-library-genre-list',\n      settings: {\n        // showSearch: false, //? Приберає поле пошуку\n        searchText: 'No genre',\n      },\n    });\n\n    refs.genreList.addEventListener('change', onSelectGenreListChange);\n    renderLibraryCards(dataStorage);\n  } else {\n    refs.genreList.removeEventListener('change', onSelectGenreListChange);\n    refs.myLibrarySection.classList.add(\n      'my-library-content-text-message-section'\n    );\n    refs.libraryContent.innerHTML = markupContentTextMessage();\n  }\n}\n\nfunction createSelectOptionMarkup({ id, name }) {\n  return ` <option value=\"${id}\">${name}</option>`;\n}\n\nfunction onSelectGenreListChange(e) {\n  page = 0;\n  correctGenre = Number(e.currentTarget.value);\n\n  if (!correctGenre) {\n    correctGenre = 'All';\n    renderLibraryCards(dataStorage);\n    return;\n  }\n  correctGenreMovieList = dataStorage.filter(el => {\n    return el.genres.some(genre => genre.id === correctGenre);\n  });\n  renderLibraryCards(correctGenreMovieList);\n}\n\nasync function renderLibraryCards(movieList) {\n  loader.onShow();\n  startIndex = 0;\n  endIndex = PER_PAGE;\n  refs.moviesList.innerHTML = '';\n  refs.loadMoreButton.style.display = 'none';\n  if (movieList.length > PER_PAGE) {\n    refs.loadMoreButton.style.display = 'block';\n    refs.loadMoreButton.addEventListener('click', onloadMoreButtonClick);\n    localStoragePagination(startIndex, endIndex, movieList);\n  } else {\n    refs.moviesList.innerHTML = await createMarkupFilmsCards(movieList);\n  }\n  loader.onClose();\n}\n\nfunction onloadMoreButtonClick() {\n  loader.onShow();\n  refs.loadMoreButton.blur();\n\n  startIndex += PER_PAGE;\n  endIndex += PER_PAGE;\n\n  if (correctGenre === 'All') {\n    localStoragePagination(startIndex, endIndex, dataStorage);\n  } else {\n    localStoragePagination(startIndex, endIndex, correctGenreMovieList);\n  }\n  loader.onClose();\n}\n\nasync function localStoragePagination(start, end, data) {\n  page += 1;\n\n  totalPage = data.length / PER_PAGE;\n\n  if (totalPage > page) {\n    const pagination = data.slice(start, end);\n\n    refs.moviesList.insertAdjacentHTML(\n      'beforeend',\n      await createMarkupFilmsCards(pagination)\n    );\n  } else {\n    const pagination = data.slice(start, end);\n    refs.moviesList.insertAdjacentHTML(\n      'beforeend',\n      await createMarkupFilmsCards(pagination)\n    );\n\n    refs.loadMoreButton.style.display = 'none';\n  }\n}\n","export const refs = {\n  myLibrarySection: document.getElementById('my-library'),\n  libraryContent: document.querySelector('.js-my-library-content'),\n  genreList: document.querySelector('.js-my-library-genre-list'),\n  moviesList: document.querySelector('.js-my-library-movies-list'),\n  loadMoreButton: document.querySelector('.js-my-library-load-more-button'),\n};\n","function getscroll() {\n  const guard = document.querySelector('.js-guard');\n  const scrollBtn = document.querySelector('.scroll-up--button');\n\n  const options = {\n    root: null,\n    rootMargin: '-100px',\n    threshold: 0.0,\n  };\n\n  const observer = new IntersectionObserver(scrollButtonShow, options);\n\n  observer.observe(guard);\n\n  function scrollButtonShow(entries, observer) {\n    entries.forEach(entry => {\n      if (entry.isIntersecting) {\n        scrollBtn.classList.add('scroll-up--button---shown');\n      } else {\n        scrollBtn.classList.remove('scroll-up--button---shown');\n      }\n    });\n  }\n}\n\nexport { getscroll };\n","export function markupContentTextMessage() {\n  return ` \n    <p class=\"my-library-content-text-message\">\n        <span>OOPS...</span>\n        <span>We are very sorry!</span>\n        <span>You don’t have any movies at your library.</span>\n    </p>\n    <a class=\"button-accent my-library-content-text-message-button\" href=\"./catalog.html\">Search movie</a>\n    `;\n}\n"],"names":["$bpxeT","parcelRequire","$e51e8fcee1d77125$export$21666b427502ea6d","myLibrarySection","document","getElementById","libraryContent","querySelector","genreList","moviesList","loadMoreButton","guard","scrollBtn","$3c15aba5a275eda1$var$loader","$kvC6y","Loader","$3c15aba5a275eda1$var$correctGenre","$3c15aba5a275eda1$var$page","$3c15aba5a275eda1$var$startIndex","$3c15aba5a275eda1$var$endIndex","$3c15aba5a275eda1$var$correctGenreMovieList","$3c15aba5a275eda1$var$dataStorage","$5C21v","default","load","$cY1yb","STORAGE_KEY","myLibraryMoviesList","$3c15aba5a275eda1$var$onSelectGenreListChange","e","Number","currentTarget","value","$3c15aba5a275eda1$var$renderLibraryCards","filter","el","genres","some","genre","id","movieList","$3c15aba5a275eda1$var$_renderLibraryCards","apply","this","arguments","$parcel$interopDefault","$2TvXO","mark","_callee","onShow","innerHTML","style","display","length","addEventListener","$3c15aba5a275eda1$var$onloadMoreButtonClick","$3c15aba5a275eda1$var$localStoragePagination","$bxNz7","createMarkupFilmsCards","_ctx","sent","onClose","blur","start","end","data","$3c15aba5a275eda1$var$_localStoragePagination","pagination","pagination1","slice","t0","insertAdjacentHTML","call","t1","t2","t3","removeEventListener","classList","add","IntersectionObserver","entries","observer","forEach","entry","isIntersecting","remove","root","rootMargin","threshold","observe","reduce","acc","$8nrFW","concat","index","self","findIndex","g","name","param","$9RsV7","select","settings","searchText","target","dataset","action","dataStorage1"],"version":3,"file":"my-library.0b810e8a.js.map"}